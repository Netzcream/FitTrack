{
  "info": {
    "_postman_id": "0c9e4265-2c69-4a84-a357-1e52e018ef28",
    "name": "FitTrack API (Central + Tenant)",
    "description": "Coleccion completa de la API de FitTrack. Incluye login central y persistencia automatica de variables en Collection Variables (token, tenant_id, ids dinamicos).",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{token}}",
        "type": "string"
      }
    ]
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://fittrack.test"
    },
    {
      "key": "email",
      "value": "student.api@example.com"
    },
    {
      "key": "password",
      "value": "password"
    },
    {
      "key": "token",
      "value": ""
    },
    {
      "key": "tenant_id",
      "value": ""
    },
    {
      "key": "tenant_domain",
      "value": ""
    },
    {
      "key": "student_id",
      "value": ""
    },
    {
      "key": "student_uuid",
      "value": ""
    },
    {
      "key": "plan_id",
      "value": "1"
    },
    {
      "key": "plan_uuid",
      "value": ""
    },
    {
      "key": "workout_id",
      "value": "1"
    },
    {
      "key": "workout_uuid",
      "value": ""
    },
    {
      "key": "workout_ref",
      "value": "1"
    },
    {
      "key": "exercise_id",
      "value": "1"
    },
    {
      "key": "conversation_id",
      "value": ""
    },
    {
      "key": "message_id",
      "value": ""
    }
  ],
  "item": [
    {
      "name": "Auth",
      "item": [
        {
          "name": "POST Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Login responde 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var data = {};",
                  "try { data = pm.response.json(); } catch (e) { data = {}; }",
                  "",
                  "if (data.token) {",
                  "    pm.collectionVariables.set('token', data.token);",
                  "}",
                  "",
                  "if (data.tenant && data.tenant.id) {",
                  "    pm.collectionVariables.set('tenant_id', String(data.tenant.id));",
                  "}",
                  "",
                  "if (data.tenant && data.tenant.domain) {",
                  "    pm.collectionVariables.set('tenant_domain', String(data.tenant.domain));",
                  "}",
                  "",
                  "if (data.student && data.student.id) {",
                  "    pm.collectionVariables.set('student_id', String(data.student.id));",
                  "}",
                  "",
                  "if (data.student && data.student.uuid) {",
                  "    pm.collectionVariables.set('student_uuid', String(data.student.uuid));",
                  "}",
                  "",
                  "if (data.user && data.user.email) {",
                  "    pm.collectionVariables.set('email', String(data.user.email));",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{email}}\",\n  \"password\": \"{{password}}\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{base_url}}/api/auth/login",
            "description": "Login central. Guarda automaticamente token, tenant_id y datos del estudiante en Collection Variables."
          }
        },
        {
          "name": "POST Logout",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/api/auth/logout"
          }
        },
        {
          "name": "GET Current User",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": "{{base_url}}/api/user"
          }
        }
      ]
    },
    {
      "name": "Home y Profile",
      "item": [
        {
          "name": "GET Home",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "X-Tenant-ID",
                "value": "{{tenant_id}}"
              }
            ],
            "url": "{{base_url}}/api/home"
          }
        },
        {
          "name": "GET Profile",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "X-Tenant-ID",
                "value": "{{tenant_id}}"
              }
            ],
            "url": "{{base_url}}/api/profile"
          }
        },
        {
          "name": "PATCH Profile",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "X-Tenant-ID",
                "value": "{{tenant_id}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"first_name\": \"Student\",\n  \"last_name\": \"API\",\n  \"phone\": \"+54 11 5555 0000\",\n  \"goal\": \"consistency\",\n  \"timezone\": \"America/Argentina/Buenos_Aires\",\n  \"height_cm\": 175,\n  \"weight_kg\": 79.4,\n  \"language\": \"es\",\n  \"notifications\": {\n    \"email\": true,\n    \"push\": true\n  },\n  \"training_experience\": \"beginner\",\n  \"days_per_week\": 4\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{base_url}}/api/profile"
          }
        }
      ]
    },
    {
      "name": "Plans",
      "item": [
        {
          "name": "GET Plans",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "X-Tenant-ID",
                "value": "{{tenant_id}}"
              }
            ],
            "url": "{{base_url}}/api/plans"
          }
        },
        {
          "name": "GET Current Plan",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "var data = {};",
                  "try { data = pm.response.json(); } catch (e) { data = {}; }",
                  "",
                  "if (data.data && data.data.id) {",
                  "    pm.collectionVariables.set('plan_id', String(data.data.id));",
                  "}",
                  "",
                  "if (data.data && data.data.uuid) {",
                  "    pm.collectionVariables.set('plan_uuid', String(data.data.uuid));",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "X-Tenant-ID",
                "value": "{{tenant_id}}"
              }
            ],
            "url": "{{base_url}}/api/plans/current"
          }
        },
        {
          "name": "GET Plan by ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "X-Tenant-ID",
                "value": "{{tenant_id}}"
              }
            ],
            "url": "{{base_url}}/api/plans/{{plan_id}}"
          }
        }
      ]
    },
    {
      "name": "Workouts",
      "item": [
        {
          "name": "GET Workouts",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "var json = {};",
                  "try { json = pm.response.json(); } catch (e) { json = {}; }",
                  "",
                  "if (json.data && Array.isArray(json.data) && json.data.length > 0) {",
                  "    var first = json.data[0];",
                  "    if (first.id) pm.collectionVariables.set('workout_id', String(first.id));",
                  "    if (first.uuid) pm.collectionVariables.set('workout_uuid', String(first.uuid));",
                  "    if (first.uuid) {",
                  "        pm.collectionVariables.set('workout_ref', String(first.uuid));",
                  "    } else if (first.id) {",
                  "        pm.collectionVariables.set('workout_ref', String(first.id));",
                  "    }",
                  "",
                  "    if (first.exercises && Array.isArray(first.exercises) && first.exercises.length > 0) {",
                  "        var ex = first.exercises[0];",
                  "        var exId = ex.exercise_id || ex.id;",
                  "        if (exId) pm.collectionVariables.set('exercise_id', String(exId));",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "X-Tenant-ID",
                "value": "{{tenant_id}}"
              }
            ],
            "url": "{{base_url}}/api/workouts"
          }
        },
        {
          "name": "GET Workout Today",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "var json = {};",
                  "try { json = pm.response.json(); } catch (e) { json = {}; }",
                  "",
                  "if (json.data) {",
                  "    var w = json.data;",
                  "    if (w.id) pm.collectionVariables.set('workout_id', String(w.id));",
                  "    if (w.uuid) pm.collectionVariables.set('workout_uuid', String(w.uuid));",
                  "    if (w.uuid) {",
                  "        pm.collectionVariables.set('workout_ref', String(w.uuid));",
                  "    } else if (w.id) {",
                  "        pm.collectionVariables.set('workout_ref', String(w.id));",
                  "    }",
                  "",
                  "    if (w.exercises && Array.isArray(w.exercises) && w.exercises.length > 0) {",
                  "        var ex = w.exercises[0];",
                  "        var exId = ex.exercise_id || ex.id;",
                  "        if (exId) pm.collectionVariables.set('exercise_id', String(exId));",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "X-Tenant-ID",
                "value": "{{tenant_id}}"
              }
            ],
            "url": "{{base_url}}/api/workouts/today"
          }
        },
        {
          "name": "GET Workout Stats",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "X-Tenant-ID",
                "value": "{{tenant_id}}"
              }
            ],
            "url": "{{base_url}}/api/workouts/stats"
          }
        },
        {
          "name": "GET Workout by ID or UUID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "X-Tenant-ID",
                "value": "{{tenant_id}}"
              }
            ],
            "url": "{{base_url}}/api/workouts/{{workout_ref}}"
          }
        },
        {
          "name": "POST Start Workout",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "X-Tenant-ID",
                "value": "{{tenant_id}}"
              }
            ],
            "url": "{{base_url}}/api/workouts/{{workout_ref}}/start"
          }
        },
        {
          "name": "PATCH Update Workout (Live + XP)",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "X-Tenant-ID",
                "value": "{{tenant_id}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"elapsed_minutes\": 14,\n  \"elapsed_seconds\": 845,\n  \"effort\": 7,\n  \"exercises\": [\n    {\n      \"exercise_id\": {{exercise_id}},\n      \"completed\": true,\n      \"sets\": [\n        {\n          \"reps\": 10,\n          \"weight\": 0,\n          \"duration_seconds\": 0,\n          \"completed\": true\n        }\n      ]\n    }\n  ]\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{base_url}}/api/workouts/{{workout_ref}}"
          }
        },
        {
          "name": "POST Complete Workout",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "X-Tenant-ID",
                "value": "{{tenant_id}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"duration_minutes\": 38,\n  \"rating\": 4,\n  \"notes\": \"Sesion completada desde Postman\",\n  \"survey\": {\n    \"effort\": 7,\n    \"fatigue\": 3,\n    \"rpe\": 8,\n    \"pain\": 1,\n    \"mood\": \"good\"\n  },\n  \"current_weight\": 79.4\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{base_url}}/api/workouts/{{workout_ref}}/complete"
          }
        },
        {
          "name": "POST Skip Workout",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "X-Tenant-ID",
                "value": "{{tenant_id}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"reason\": \"Saltado desde Postman\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{base_url}}/api/workouts/{{workout_ref}}/skip"
          }
        }
      ]
    },
    {
      "name": "Weight",
      "item": [
        {
          "name": "GET Weight History",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "X-Tenant-ID",
                "value": "{{tenant_id}}"
              }
            ],
            "url": "{{base_url}}/api/weight?limit=30&days=30"
          }
        },
        {
          "name": "GET Latest Weight",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "X-Tenant-ID",
                "value": "{{tenant_id}}"
              }
            ],
            "url": "{{base_url}}/api/weight/latest"
          }
        },
        {
          "name": "GET Weight Change",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "X-Tenant-ID",
                "value": "{{tenant_id}}"
              }
            ],
            "url": "{{base_url}}/api/weight/change?days=30"
          }
        },
        {
          "name": "GET Weight Average",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "X-Tenant-ID",
                "value": "{{tenant_id}}"
              }
            ],
            "url": "{{base_url}}/api/weight/average?days=30"
          }
        },
        {
          "name": "POST Record Weight",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "X-Tenant-ID",
                "value": "{{tenant_id}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"weight_kg\": 79.1,\n  \"source\": \"api\",\n  \"notes\": \"Registro desde Postman\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{base_url}}/api/weight"
          }
        }
      ]
    },
    {
      "name": "Progress y Payments",
      "item": [
        {
          "name": "GET Progress Dashboard",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "X-Tenant-ID",
                "value": "{{tenant_id}}"
              }
            ],
            "url": "{{base_url}}/api/progress/dashboard"
          }
        },
        {
          "name": "GET Progress Summary",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "X-Tenant-ID",
                "value": "{{tenant_id}}"
              }
            ],
            "url": "{{base_url}}/api/progress"
          }
        },
        {
          "name": "GET Recent Workouts",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "X-Tenant-ID",
                "value": "{{tenant_id}}"
              }
            ],
            "url": "{{base_url}}/api/progress/recent?limit=10"
          }
        },
        {
          "name": "GET Payments",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "X-Tenant-ID",
                "value": "{{tenant_id}}"
              }
            ],
            "url": "{{base_url}}/api/payments"
          }
        }
      ]
    },
    {
      "name": "Messaging",
      "item": [
        {
          "name": "GET Conversation",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "var data = {};",
                  "try { data = pm.response.json(); } catch (e) { data = {}; }",
                  "",
                  "if (data.conversation && data.conversation.id) {",
                  "    pm.collectionVariables.set('conversation_id', String(data.conversation.id));",
                  "}",
                  "",
                  "if (data.messages && Array.isArray(data.messages.data) && data.messages.data.length > 0) {",
                  "    var firstMsg = data.messages.data[0];",
                  "    if (firstMsg.id) pm.collectionVariables.set('message_id', String(firstMsg.id));",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "X-Tenant-ID",
                "value": "{{tenant_id}}"
              }
            ],
            "url": "{{base_url}}/api/messages/conversation?per_page=50"
          }
        },
        {
          "name": "POST Send Message",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "X-Tenant-ID",
                "value": "{{tenant_id}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"body\": \"Hola coach, mensaje de prueba desde Postman.\",\n  \"attachments\": []\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{base_url}}/api/messages/send"
          }
        },
        {
          "name": "POST Mark Conversation As Read",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "X-Tenant-ID",
                "value": "{{tenant_id}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{base_url}}/api/messages/read"
          }
        },
        {
          "name": "POST Toggle Mute",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "X-Tenant-ID",
                "value": "{{tenant_id}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"mute\": true\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{base_url}}/api/messages/mute"
          }
        },
        {
          "name": "GET Unread Count",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "X-Tenant-ID",
                "value": "{{tenant_id}}"
              }
            ],
            "url": "{{base_url}}/api/messages/unread-count"
          }
        }
      ]
    }
  ]
}
